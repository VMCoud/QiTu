import{_ as Ne}from"./nuxt-link.1ccb43b1.js";import{al as oe,am as je,ai as Te,aj as Ae,an as re,ao as Ee,ap as He,aq as Pe}from"./api.75434be6.js";import{d as De,r as i,s as Ge,z as V,u as G,G as Ze,b as _,o as g,i as B,w as l,g as a,e as r,f as m,c as x,h as c,j as N,t as ie,C as ne,M as d}from"./entry.f3a6b6f6.js";import{I as Je,_ as ce}from"./safe_login.a991f1f7.js";import{I as ue,a as Ke,_ as Oe}from"./wechat.f8f675e5.js";import{u as Qe}from"./counter.8b7d25a0.js";import{c as We,a as Xe,b as Ye,S as ea}from"./captcha-2.41d59436.js";import{I as aa}from"./index.8ed57307.js";import{I as Z}from"./index.e62e449a.js";import{I as de}from"./index.25e3049d.js";const la=["innerHTML"],ta={class:"dialog-footer"},sa={class:"w-100 dialog_login"},oa={key:0,class:"card login_card border-0"},ra={class:"card-body"},ia=r("img",{src:ce,alt:"",class:"w-28 m-auto mb-2"},null,-1),na=r("p",{class:"text-center mb-6"},"登录自主用户，开始聊天",-1),ua={class:"form-group d-flex justify-content-between mb-2"},da={key:0,class:"mt-6"},ca=r("div",{class:"relative"},[r("div",{class:"absolute inset-0 flex items-center"},[r("div",{class:"w-full border-t border-gray-300"})]),r("div",{class:"relative flex justify-center text-sm"},[r("span",{class:"bg-white px-2 text-gray-500"},"第三方登录")])],-1),ma={key:0,class:"mt-3 grid grid-cols-1 gap-1 mb-3"},_a=r("span",{class:"sr-only"},"Sign in with Twitter",-1),fa=r("svg",{t:"1684751208419",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"23618",width:"26",height:"26"},[r("path",{d:"M512 512m-447.9 0a447.9 447.9 0 1 0 895.8 0 447.9 447.9 0 1 0-895.8 0Z",fill:"#00C785","p-id":"23619"}),r("path",{d:"M741.6 567.5c0-63.7-63.7-115.5-135.3-115.5-75.9 0-135.5 51.9-135.5 115.5 0 63.8 59.6 115.5 135.5 115.5 15.9 0 31.9-4 47.8-7.9l43.7 24-12-39.8c32-24 55.8-56 55.8-91.8z m-179.3-19.9c-7.9 0-15.9-7.9-15.9-15.9 0-7.9 7.9-15.9 15.9-15.9 12 0 20 7.9 20 15.9s-8 15.9-20 15.9z m87.7 0c-7.9 0-15.8-7.9-15.8-15.9 0-7.9 7.9-15.9 15.8-15.9 12 0 19.9 7.9 19.9 15.9 0.1 8-8.1 15.9-19.9 15.9z m0 0",fill:"#FFFFFF","p-id":"23620"}),r("path",{d:"M593.1 437.9c5.2 0 10.5 0.4 15.7 0.9-14-65.6-84.1-114.2-164.1-114.2-89.4 0-162.7 60.9-162.7 138.3 0 44.7 24.3 81.4 65 109.9l-16.2 49 56.9-28.6c20.4 4 36.7 8.1 56.9 8.1 5 0 10.1-0.2 15.1-0.7-3.2-10.8-5-22.3-5-34.1 0.1-70.9 61.2-128.6 138.4-128.6z m-87.5-44.1c12.2 0 20.3 8.1 20.3 20.4 0 12.2-8.1 20.3-20.3 20.3-12.3 0-24.5-8.1-24.5-20.3 0.2-12.3 12.4-20.4 24.5-20.4z m-113.9 40.7c-12.3 0-24.5-8.1-24.5-20.3 0-12.3 12.2-20.4 24.5-20.4s20.4 8.1 20.4 20.4c0 12-8.1 20.3-20.4 20.3z m0 0",fill:"#FFFFFF","p-id":"23621"})],-1),pa=[_a,fa],ga={class:"text-center mb-0"},va={key:1,class:"card login_card border-0"},ha={class:"card-body"},ba=r("img",{src:Oe,alt:"",class:"m-auto mb-2"},null,-1),wa=r("p",{class:"text-center mb-6"},"打开微信[扫一扫]登录",-1),ya={key:2,class:"card register_card border-0"},ka={class:"card-body"},Va=r("img",{src:ce,alt:"",class:"w-28 m-auto mb-2"},null,-1),xa=r("p",{class:"text-center mb-6"},"创建一个免费账户",-1),Fa={class:"text-center mb-0"},Ba=De({__name:"Login",props:{login_dialog:{type:Boolean,default:!1}},emits:["handleCancel"],setup(me,{emit:_e}){const fe=me,I=Qe(),U=i(!0),L=i(),pe=()=>{L.value="",U.value=!1},q=()=>{L.value="",j.value=!1,U.value=!0};i("");const R=i(),ge=()=>{var s;d.error("检测到非人为操作的哦！ try again"),(s=R.value)==null||s.refresh()},F=i(!1),S=i(""),J=i("email"),K=s=>{if(J.value=s,s=="email"){if(n.email==""){d.error("请填写邮箱");return}oe({type:"email",email:n.email}).then(e=>{var o;e._rawValue.status==200&&((o=R.value)==null||o.refresh(),F.value=!0,S.value=e._rawValue.data)}).catch(e=>{console.log(e)})}else{if(u.phone==""){d.error("请填写手机号");return}oe({type:"phone",phone:u.phone}).then(e=>{var o;e._rawValue.status==200&&((o=R.value)==null||o.refresh(),F.value=!0,S.value=e._rawValue.data)}).catch(e=>{console.log(e)})}},ve=s=>{F.value=!1,J.value=="email"?Re():$e()},he=()=>{d.error("验证不通过")},be=()=>{d.info("刷新图形")},$=Ge({get(){return fe.login_dialog},set(s){_e("handleCancel",s)}}),we=()=>{$.value=!1};i(""),i("");const ye=i(),b=V({email:"",password:""});V({email:[{required:!0,message:"请输入邮箱或手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]});const M=i(!1),O=G("token",{maxAge:60*60*24*2}),Q=G("user_info"),W=Ze(),X=G("message"),ke=async({values:s,errors:e})=>{if(e)return d.error("请填写登录信息"),!1;M.value=!0,je({email:b.email,password:b.password}).then(o=>{M.value=!1,o._rawValue.status==200&&(we(),X.value="",O.value=o._rawValue.token,Q.value=o._rawValue.user_info,d.success(o._rawValue.message),W.go(0))}).catch(o=>{M.value=!1})},Y=i(),j=i(!1),ee=()=>{U.value=!1,j.value=!0,Te({type:"login"}).then(s=>{L.value=s._rawValue.data,Y.value=s._rawValue.id;let e=setInterval(()=>{Ae({id:Y.value}).then(o=>{o._rawValue.status==200&&(clearInterval(e),X.value="",O.value=o._rawValue.token,Q.value=o._rawValue.user_info,d.success(o._rawValue.message),W.go(0))}).catch(o=>{clearInterval(e)})},5e3)}).catch(s=>{d.error(s)})},v=i(I.setting.register_way?I.setting.register_way:"1");v.value==4&&ee();const Ve=i(),xe=i(),n=V({email:"",password:"",email_code:"",invite_code:"",check_xieyi:!1}),u=V({phone:"",password:"",phone_code:"",invite_code:"",check_xieyi:!1});{const s=new URLSearchParams(window.location.search);s.get("invite_code")&&(n.invite_code=s.get("invite_code"),u.invite_code=s.get("invite_code"))}const Fe=V({phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{match:/^1[3456789]\d{9}$/,message:"请输入正确的手机号",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],phone_code:[{required:!0,message:"请输入手机验证码",trigger:"blur"}]}),ae=()=>{z.value=!0,Ue()},Ce=V({email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],email_code:[{required:!0,message:"请输入邮箱验证码",trigger:"blur"}]}),h=i(!1),Ie=async({values:s,errors:e})=>{if(e)return d.error("请补全注册信息"),!1;if(n.check_xieyi==!1){d.error("请同意用户协议");return}h.value=!0,re({email:n.email,password:n.password,email_code:n.email_code,invite_code:n.invite_code}).then(o=>{o._rawValue.status==200&&(d.success(o._rawValue.message),q(),h.value=!1)}).catch(o=>{h.value=!1})},z=i(!1),T=i({}),C=i(!1),Ue=()=>{C.value=!0,Ee().then(s=>{T.value=s._rawValue.data,C.value=!1}).catch(s=>{console.log(s),C.value=!1})},Le=()=>{z.value=!1,n.check_xieyi=!0,u.check_xieyi=!0},qe=async({values:s,errors:e})=>{if(e)return d.error("请补全注册信息"),!1;if(u.check_xieyi==!1){d.error("请同意用户协议");return}h.value=!0,re({phone:u.phone,password:u.password,phone_code:u.phone_code,invite_code:u.invite_code}).then(o=>{o._rawValue.status==200&&(d.success(o._rawValue.message),q(),h.value=!1)}).catch(o=>{h.value=!1})},y=i("发送验证码"),p=i(!1),A=v==="1"?"first":v=="2"?"second":"first",Re=()=>{if(n.email==""){d.error("请填写邮箱");return}p.value=!0,He({email:n.email,verify_code:S.value}).then(s=>{if(s._rawValue.status==200){d.success(s._rawValue.message);let e=60;const o=setInterval(()=>{if(e<=0){y.value="发送验证码",p.value=!1,clearInterval(o);return}y.value=e+"s",p.value=!0,e--},1e3)}}).catch(s=>{p.value=!1,console.log(s)})},Se=i([We,Xe,Ye]),$e=()=>{if(u.phone==""){d.error("请填写手机号");return}p.value=!0,Pe({phone:u.phone,verify_code:S.value}).then(s=>{if(s._rawValue.status==200){d.success(s._rawValue.message);let e=60;const o=setInterval(()=>{if(e<=0){y.value="发送验证码",p.value=!1,clearInterval(o);return}y.value=e+"s",p.value=!0,e--},1e3)}}).catch(s=>{p.value=!1,console.log(s)})};return(s,e)=>{const o=_("a-skeleton-line"),E=_("a-space"),Me=_("a-skeleton"),k=_("a-button"),H=_("a-modal"),w=_("a-input"),f=_("a-form-item"),P=_("a-input-password"),le=Ne,D=_("a-form"),ze=_("a-image"),te=_("a-checkbox"),se=_("a-tab-pane"),Be=_("a-tabs");return g(),B(H,{footer:!1,visible:c($),"onUpdate:visible":e[23]||(e[23]=t=>ne($)?$.value=t:null),simple:"",class:"mb_dialog dialog_login_of"},{default:l(()=>[a(H,{visible:z.value,"onUpdate:visible":e[1]||(e[1]=t=>z.value=t),title:T.value.title,class:"dialog_login_of"},{footer:l(()=>[r("span",ta,[a(k,{type:"primary",onClick:e[0]||(e[0]=t=>Le())},{default:l(()=>[m(" 同意协议 ")]),_:1})])]),default:l(()=>[C.value?(g(),B(Me,{key:0,animation:C.value},{default:l(()=>[a(E,{direction:"vertical",style:{width:"100%"},size:"large"},{default:l(()=>[a(o,{rows:3})]),_:1})]),_:1},8,["animation"])):(g(),x("div",{key:1,innerHTML:T.value.description},null,8,la))]),_:1},8,["visible","title"]),r("div",sa,[U.value&&v.value!=4?(g(),x("div",oa,[r("div",ra,[ia,na,a(D,{ref_key:"ruleFormRefLogin",ref:ye,model:b,class:"demo-ruleForm","status-icon":"",onSubmit:ke},{default:l(()=>[a(f,{"hide-label":!0,field:"email",rules:[{required:!0,message:"邮箱或手机号不得为空"}]},{default:l(()=>[a(w,{modelValue:b.email,"onUpdate:modelValue":e[2]||(e[2]=t=>b.email=t),placeholder:"输入你的邮箱/手机号"},{prefix:l(()=>[a(c(aa))]),_:1},8,["modelValue"])]),_:1}),a(f,{"hide-label":!0,field:"password",rules:[{required:!0,message:"密码不得为空"},{minLength:6,message:"必须输入大于6个字符"}]},{default:l(()=>[a(P,{modelValue:b.password,"onUpdate:modelValue":e[3]||(e[3]=t=>b.password=t),placeholder:"输入你的密码"},{prefix:l(()=>[a(c(Z))]),_:1},8,["modelValue"])]),_:1}),r("div",ua,[a(le,{class:"link",href:"/users/reset"},{default:l(()=>[m("忘记密码")]),_:1})]),a(k,{loading:M.value,type:"primary","html-type":"submit",class:"login mb-2"},{default:l(()=>[m(" 登录 ")]),_:1},8,["loading"])]),_:1},8,["model"]),c(I).setting.three_login_open=="1"?(g(),x("div",da,[ca,c(I).setting.wechat_login=="1"?(g(),x("div",ma,[r("div",null,[r("div",{onClick:e[4]||(e[4]=t=>ee()),class:"inline-flex w-full justify-center rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-500 shadow-sm hover:bg-gray-50"},pa)])])):N("",!0)])):N("",!0),r("p",ga,[m("还没有账户？ "),r("span",{class:"link cursor-pointer",onClick:e[5]||(e[5]=t=>pe())},"注册一个"),m(" . ")])])])):j.value||v.value==4?(g(),x("div",va,[r("div",ha,[ba,wa,a(ze,{src:L.value,alt:""},null,8,["src"])]),a(le,{onClick:q,class:"text-center cursor-pointer"},{default:l(()=>[m("返回登录")]),_:1})])):(g(),x("div",ya,[r("div",ka,[Va,xa,a(Be,{type:"capsule",modelValue:c(A),"onUpdate:modelValue":e[20]||(e[20]=t=>ne(A)?A.value=t:null),class:"demo-tabs reg_demo_tabs"},{default:l(()=>[v.value=="1"||v.value=="3"?(g(),B(se,{title:"邮箱注册",key:"first"},{default:l(()=>[a(D,{ref_key:"ruleFormRef",ref:Ve,model:n,rules:Ce,class:"demo-ruleForm","status-icon":"",onSubmit:Ie},{default:l(()=>[a(f,{"hide-label":!0,"hide-asterisk":!0,field:"email"},{default:l(()=>[a(w,{modelValue:n.email,"onUpdate:modelValue":e[6]||(e[6]=t=>n.email=t),placeholder:"请填写您的邮箱"},{prefix:l(()=>[a(c(Je))]),_:1},8,["modelValue"])]),_:1}),a(f,{"hide-label":!0,"hide-asterisk":!0,field:"email_code"},{default:l(()=>[a(E,null,{default:l(()=>[a(w,{modelValue:n.email_code,"onUpdate:modelValue":e[7]||(e[7]=t=>n.email_code=t),placeholder:"邮箱验证码"},{prefix:l(()=>[a(c(de))]),_:1},8,["modelValue"]),a(k,{loading:p.value,type:"primary",onClick:e[8]||(e[8]=t=>K("email"))},{default:l(()=>[m(ie(y.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),a(f,{"hide-label":!0,"hide-asterisk":!0,field:"password"},{default:l(()=>[a(P,{modelValue:n.password,"onUpdate:modelValue":e[9]||(e[9]=t=>n.password=t),placeholder:"填写您的密码"},{prefix:l(()=>[a(c(Z))]),_:1},8,["modelValue"])]),_:1}),a(f,{"hide-label":!0,"hide-asterisk":!0,field:"invite_code",class:"mb-2"},{default:l(()=>[a(w,{modelValue:n.invite_code,"onUpdate:modelValue":e[10]||(e[10]=t=>n.invite_code=t),placeholder:"填写您的邀请码（可选）"},{prefix:l(()=>[a(c(ue))]),_:1},8,["modelValue"])]),_:1}),a(f,{"hide-label":!0,"hide-asterisk":!0,field:"check_xieyi",class:"mb-2 mt-0"},{default:l(()=>[a(te,{type:"check_xieyi",modelValue:n.check_xieyi,"onUpdate:modelValue":e[11]||(e[11]=t=>n.check_xieyi=t),onClick:e[12]||(e[12]=t=>ae())},{default:l(()=>[m(" 同意《用户协议》 ")]),_:1},8,["modelValue"])]),_:1}),a(k,{type:"primary",loading:h.value,class:"register w-100 mb-2","html-type":"submit"},{default:l(()=>[m(" 注册 ")]),_:1},8,["loading"])]),_:1},8,["model","rules"])]),_:1})):N("",!0),v.value=="2"||v.value=="3"?(g(),B(se,{title:"手机注册",key:"second"},{default:l(()=>[a(D,{ref_key:"ruleFormRefs",ref:xe,model:u,rules:Fe,class:"demo-ruleForm",onSubmit:qe,"status-icon":""},{default:l(()=>[a(f,{"hide-label":!0,"hide-asterisk":!0,field:"phone"},{default:l(()=>[a(w,{modelValue:u.phone,"onUpdate:modelValue":e[13]||(e[13]=t=>u.phone=t),placeholder:"请填写您的手机号"},{prefix:l(()=>[a(c(Ke))]),_:1},8,["modelValue"])]),_:1}),a(f,{"hide-label":!0,"hide-asterisk":!0,field:"phone_code"},{default:l(()=>[a(E,null,{default:l(()=>[a(w,{modelValue:u.phone_code,"onUpdate:modelValue":e[14]||(e[14]=t=>u.phone_code=t),placeholder:"请填写您的手机验证码"},{prefix:l(()=>[a(c(de))]),_:1},8,["modelValue"]),a(k,{loading:p.value,type:"primary",onClick:e[15]||(e[15]=t=>K("phone"))},{default:l(()=>[m(ie(y.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),a(f,{"hide-label":!0,"hide-asterisk":!0,field:"password"},{default:l(()=>[a(P,{modelValue:u.password,"onUpdate:modelValue":e[16]||(e[16]=t=>u.password=t),placeholder:"填写您的密码"},{prefix:l(()=>[a(c(Z))]),_:1},8,["modelValue"])]),_:1}),a(f,{"hide-label":!0,"hide-asterisk":!0,field:"invite_code",class:"mb-2"},{default:l(()=>[a(w,{modelValue:u.invite_code,"onUpdate:modelValue":e[17]||(e[17]=t=>u.invite_code=t),placeholder:"填写您的邀请码（可选）"},{prefix:l(()=>[a(c(ue))]),_:1},8,["modelValue"])]),_:1}),a(f,{"hide-label":!0,"hide-asterisk":!0,field:"check_xieyi",class:"mb-2 mt-0"},{default:l(()=>[a(te,{modelValue:u.check_xieyi,"onUpdate:modelValue":e[18]||(e[18]=t=>u.check_xieyi=t),onClick:e[19]||(e[19]=t=>ae())},{default:l(()=>[m(" 同意《用户协议》 ")]),_:1},8,["modelValue"])]),_:1}),a(k,{type:"primary",loading:h.value,class:"register w-100 mb-2","html-type":"submit"},{default:l(()=>[m(" 注册 ")]),_:1},8,["loading"])]),_:1},8,["model","rules"])]),_:1})):N("",!0)]),_:1},8,["modelValue"]),r("p",Fa,[m("已经有账户了? "),r("span",{class:"link cursor-pointer",onClick:e[21]||(e[21]=t=>q())},"登录"),m(".")])])]))]),a(H,{class:"pic_cap",visible:F.value,"onUpdate:visible":e[22]||(e[22]=t=>F.value=t),title:"图形验证",footer:!1},{default:l(()=>[a(c(ea),{imgs:Se.value,ref_key:"block",ref:R,"slider-text":"拖拽滑动",onAgain:ge,onSuccess:ve,onFail:he,class:"m-auto",onRefresh:be},null,8,["imgs"])]),_:1},8,["visible"])]),_:1},8,["visible"])}}});export{Ba as _};
